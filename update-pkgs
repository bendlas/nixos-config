#!/usr/bin/env nix-shell
#! nix-shell -i bash -p git nix-prefetch-git jq

if [ -z "$1" ]
then branch="dev-master"
else branch="$1"
fi

CODE=$(readlink -f ..)

fetch() {
    remoteRepo=$1
    localRepo=$2
    branch=$3
    rev=$(git ls-remote $localRepo refs/heads/$branch | cut -f1)
    nix-prefetch-git $localRepo $rev | jq ".url=\"${remoteRepo}\" | .branch=\"${branch}\""
}

fetch https://github.com/bendlas/nixpkgs.git $CODE/nixpkgs $branch > nixpkgs.json
fetch https://github.com/bendlas/mobile-nixos.git $CODE/mobile-nixos master > mobile-nixos.json
fetch https://github.com/nix-community/emacs-overlay.git https://github.com/nix-community/emacs-overlay.git master > emacs-overlay.json
fetch https://github.com/NixOS/nixos-hardware.git https://github.com/NixOS/nixos-hardware.git master > nixos-hardware.json
